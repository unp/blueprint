/*
 * Copyright 2015 Palantir Technologies, Inc. All rights reserved.
 * Licensed under the BSD-3 License as modified (the “License”); you may obtain a copy
 * of the license at https://github.com/palantir/blueprint/blob/master/LICENSE
 * and https://github.com/palantir/blueprint/blob/master/PATENTS
 */
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var core_1 = require("@blueprintjs/core");
var classNames = require("classnames");
var React = require("react");
var Classes = require("./common/classes");
var DateUtils = require("./common/dateUtils");
var Utils = require("./common/utils");
(function (TimePickerPrecision) {
    TimePickerPrecision[TimePickerPrecision["MINUTE"] = 0] = "MINUTE";
    TimePickerPrecision[TimePickerPrecision["SECOND"] = 1] = "SECOND";
    TimePickerPrecision[TimePickerPrecision["MILLISECOND"] = 2] = "MILLISECOND";
})(exports.TimePickerPrecision || (exports.TimePickerPrecision = {}));
var TimePickerPrecision = exports.TimePickerPrecision;
var TimePicker = (function (_super) {
    __extends(TimePicker, _super);
    function TimePicker(props, context) {
        var _this = this;
        _super.call(this, props, context);
        this.displayName = "Blueprint.TimePicker";
        // begin method definitions: event handlers
        this.getInputBlurHandler = function (unit) { return function (e) {
            var text = getStringValueFromInputEvent(e);
            _this.updateTime(parseInt(text, 10), unit);
        }; };
        this.getInputChangeHandler = function (unit) { return function (e) {
            var TWO_DIGITS = /^\d{0,2}$/;
            var THREE_DIGITS = /^\d{0,3}$/;
            var text = getStringValueFromInputEvent(e);
            var isValid = false;
            switch (unit) {
                case TimeUnit.HOUR:
                case TimeUnit.MINUTE:
                case TimeUnit.SECOND:
                    isValid = TWO_DIGITS.test(text);
                    break;
                case TimeUnit.MS:
                    isValid = THREE_DIGITS.test(text);
                    break;
                default:
                    throw Error("Invalid TimeUnit");
            }
            if (isValid) {
                switch (unit) {
                    case TimeUnit.HOUR:
                        _this.updateState({ hourText: text });
                        break;
                    case TimeUnit.MINUTE:
                        _this.updateState({ minuteText: text });
                        break;
                    case TimeUnit.SECOND:
                        _this.updateState({ secondText: text });
                        break;
                    case TimeUnit.MS:
                        _this.updateState({ millisecondText: text });
                        break;
                    default: throw Error("Invalid TimeUnit");
                }
            }
        }; };
        this.getInputKeyDownHandler = function (unit) { return function (e) {
            handleKeyEvent(e, (_a = {},
                _a[core_1.Keys.ARROW_UP] = function () { return _this.incrementTime(unit); },
                _a[core_1.Keys.ARROW_DOWN] = function () { return _this.decrementTime(unit); },
                _a[core_1.Keys.ENTER] = function () {
                    e.currentTarget.blur();
                },
                _a
            ));
            var _a;
        }; };
        if (props.value != null) {
            this.state = this.getFullStateFromValue(props.value);
        }
        else if (props.defaultValue != null) {
            this.state = this.getFullStateFromValue(props.defaultValue);
        }
        else {
            this.state = this.getFullStateFromValue(new Date(0, 0, 0, 0, 0, 0, 0));
        }
    }
    TimePicker.prototype.render = function () {
        var _this = this;
        var shouldRenderSeconds = this.props.precision >= TimePickerPrecision.SECOND;
        var shouldRenderMilliseconds = this.props.precision >= TimePickerPrecision.MILLISECOND;
        /* tslint:disable:max-line-length */
        return (React.createElement("div", {className: classNames(Classes.TIMEPICKER, this.props.className)}, 
            React.createElement("div", {className: Classes.TIMEPICKER_ARROW_ROW}, 
                this.maybeRenderArrowButton(true, Classes.TIMEPICKER_HOUR, function () { return _this.incrementTime(TimeUnit.HOUR); }), 
                this.maybeRenderArrowButton(true, Classes.TIMEPICKER_MINUTE, function () { return _this.incrementTime(TimeUnit.MINUTE); }), 
                shouldRenderSeconds ? this.maybeRenderArrowButton(true, Classes.TIMEPICKER_SECOND, function () { return _this.incrementTime(TimeUnit.SECOND); }) : null, 
                shouldRenderMilliseconds ? this.maybeRenderArrowButton(true, Classes.TIMEPICKER_MILLISECOND, function () { return _this.incrementTime(TimeUnit.MS); }) : null), 
            React.createElement("div", {className: Classes.TIMEPICKER_INPUT_ROW}, 
                this.renderInput(Classes.TIMEPICKER_HOUR, TimeUnit.HOUR, this.state.hourText), 
                this.renderDivider(), 
                this.renderInput(Classes.TIMEPICKER_MINUTE, TimeUnit.MINUTE, this.state.minuteText), 
                shouldRenderSeconds ? this.renderDivider() : null, 
                shouldRenderSeconds ? this.renderInput(Classes.TIMEPICKER_SECOND, TimeUnit.SECOND, this.state.secondText) : null, 
                shouldRenderMilliseconds ? this.renderDivider(".") : null, 
                shouldRenderMilliseconds ? this.renderInput(Classes.TIMEPICKER_MILLISECOND, TimeUnit.MS, this.state.millisecondText) : null), 
            React.createElement("div", {className: Classes.TIMEPICKER_ARROW_ROW}, 
                this.maybeRenderArrowButton(false, Classes.TIMEPICKER_HOUR, function () { return _this.decrementTime(TimeUnit.HOUR); }), 
                this.maybeRenderArrowButton(false, Classes.TIMEPICKER_MINUTE, function () { return _this.decrementTime(TimeUnit.MINUTE); }), 
                shouldRenderSeconds ? this.maybeRenderArrowButton(false, Classes.TIMEPICKER_SECOND, function () { return _this.decrementTime(TimeUnit.SECOND); }) : null, 
                shouldRenderMilliseconds ? this.maybeRenderArrowButton(false, Classes.TIMEPICKER_MILLISECOND, function () { return _this.decrementTime(TimeUnit.MS); }) : null)));
        /* tslint:enable:max-line-length */
    };
    TimePicker.prototype.componentWillReceiveProps = function (nextProps) {
        if (nextProps.value != null && !DateUtils.areSameTime(nextProps.value, this.props.value)) {
            this.setState(this.getFullStateFromValue(nextProps.value));
        }
    };
    // begin method definitions: rendering
    TimePicker.prototype.maybeRenderArrowButton = function (isDirectionUp, className, onClick) {
        var classes = classNames(Classes.TIMEPICKER_ARROW_BUTTON, className, "pt-icon-standard", {
            "pt-icon-chevron-down": !isDirectionUp,
            "pt-icon-chevron-up": isDirectionUp,
        });
        return this.props.showArrowButtons ? React.createElement("span", {className: classes, onClick: onClick}) : null;
    };
    TimePicker.prototype.renderDivider = function (text) {
        if (text === void 0) { text = ":"; }
        return React.createElement("span", {className: Classes.TIMEPICKER_DIVIDER_TEXT}, text);
    };
    TimePicker.prototype.renderInput = function (className, unit, value) {
        return (React.createElement("input", {className: classNames(Classes.TIMEPICKER_INPUT, className), onBlur: this.getInputBlurHandler(unit), onChange: this.getInputChangeHandler(unit), onKeyDown: this.getInputKeyDownHandler(unit), value: value}));
    };
    // begin method definitions: state modification
    /**
     * Generates a full ITimePickerState object with all text fields set to formatted strings based on value
     */
    TimePicker.prototype.getFullStateFromValue = function (value) {
        /* tslint:disable:object-literal-sort-keys */
        return {
            hourText: formatTime(value.getHours(), TimeUnit.HOUR),
            minuteText: formatTime(value.getMinutes(), TimeUnit.MINUTE),
            secondText: formatTime(value.getSeconds(), TimeUnit.SECOND),
            millisecondText: formatTime(value.getMilliseconds(), TimeUnit.MS),
            value: value,
        };
        /* tslint:enable:object-literal-sort-keys */
    };
    TimePicker.prototype.incrementTime = function (unit) {
        var newTime = getTimeUnit(this.state.value, unit) + 1;
        this.updateTime(loopTime(newTime, unit), unit);
    };
    TimePicker.prototype.decrementTime = function (unit) {
        var newTime = getTimeUnit(this.state.value, unit) - 1;
        this.updateTime(loopTime(newTime, unit), unit);
    };
    TimePicker.prototype.updateTime = function (time, unit) {
        if (isTimeValid(time, unit)) {
            var newValue = DateUtils.clone(this.state.value);
            setTimeUnit(time, newValue, unit);
            this.updateState({ value: newValue });
        }
        else {
            // reset to last known good state
            this.updateState(this.getFullStateFromValue(this.state.value));
        }
    };
    TimePicker.prototype.updateState = function (state) {
        var newState = state;
        var hasNewValue = newState.value != null
            && !DateUtils.areSameTime(newState.value, this.state.value);
        if (this.props.value == null) {
            // component is uncontrolled
            if (hasNewValue) {
                newState = this.getFullStateFromValue(newState.value);
            }
            this.setState(newState);
        }
        else {
            // component is controlled, and there's a new value
            // so set inputs' text based off of _old_ value and later fire onChange with new value
            if (hasNewValue) {
                this.setState(this.getFullStateFromValue(this.state.value));
            }
            else {
                // no new value, this means only text has changed (from user typing)
                // we want inputs to change, so update state with new text for the inputs
                // but don't change actual value
                var clonedNewState = core_1.Utils.shallowClone(newState);
                clonedNewState.value = DateUtils.clone(this.state.value);
                this.setState(clonedNewState);
            }
        }
        if (hasNewValue) {
            core_1.Utils.safeInvoke(this.props.onChange, newState.value);
        }
    };
    TimePicker.defaultProps = {
        precision: TimePickerPrecision.MINUTE,
        showArrowButtons: false,
    };
    return TimePicker;
}(React.Component));
exports.TimePicker = TimePicker;
var TimeUnit;
(function (TimeUnit) {
    TimeUnit[TimeUnit["HOUR"] = 0] = "HOUR";
    TimeUnit[TimeUnit["MINUTE"] = 1] = "MINUTE";
    TimeUnit[TimeUnit["SECOND"] = 2] = "SECOND";
    TimeUnit[TimeUnit["MS"] = 3] = "MS";
})(TimeUnit || (TimeUnit = {}));
function formatTime(time, unit) {
    switch (unit) {
        case TimeUnit.HOUR:
            return time.toString();
        case TimeUnit.MINUTE:
        case TimeUnit.SECOND:
            return Utils.padWithZeroes(time.toString(), 2);
        case TimeUnit.MS:
            return Utils.padWithZeroes(time.toString(), 3);
        default:
            throw Error("Invalid TimeUnit");
    }
}
function getStringValueFromInputEvent(e) {
    return e.currentTarget.value;
}
function getTimeUnit(date, unit) {
    switch (unit) {
        case TimeUnit.HOUR: return date.getHours();
        case TimeUnit.MINUTE: return date.getMinutes();
        case TimeUnit.SECOND: return date.getSeconds();
        case TimeUnit.MS: return date.getMilliseconds();
        default: throw Error("Invalid TimeUnit");
    }
}
function handleKeyEvent(e, actions, preventDefault) {
    if (preventDefault === void 0) { preventDefault = true; }
    for (var _i = 0, _a = Object.keys(actions); _i < _a.length; _i++) {
        var k = _a[_i];
        var key = Number(k);
        if (e.which === key) {
            if (preventDefault) {
                e.preventDefault();
            }
            actions[key]();
        }
    }
}
function isTimeValid(time, unit) {
    return time != null && !isNaN(time) && minTime(unit) <= time && time <= maxTime(unit);
}
function loopTime(time, unit) {
    var max = maxTime(unit);
    var min = minTime(unit);
    if (time > max) {
        return min;
    }
    else if (time < min) {
        return max;
    }
    return time;
}
function minTime(unit) {
    var min = (_a = {},
        _a[TimeUnit.HOUR] = 0,
        _a[TimeUnit.MINUTE] = 0,
        _a[TimeUnit.SECOND] = 0,
        _a[TimeUnit.MS] = 0,
        _a
    );
    return min[unit];
    var _a;
}
function maxTime(unit) {
    var max = (_a = {},
        _a[TimeUnit.HOUR] = 23,
        _a[TimeUnit.MINUTE] = 59,
        _a[TimeUnit.SECOND] = 59,
        _a[TimeUnit.MS] = 999,
        _a
    );
    return max[unit];
    var _a;
}
function setTimeUnit(time, date, unit) {
    switch (unit) {
        case TimeUnit.HOUR:
            date.setHours(time);
            break;
        case TimeUnit.MINUTE:
            date.setMinutes(time);
            break;
        case TimeUnit.SECOND:
            date.setSeconds(time);
            break;
        case TimeUnit.MS:
            date.setMilliseconds(time);
            break;
        default: throw Error("Invalid TimeUnit");
    }
}
exports.TimePickerFactory = React.createFactory(TimePicker);

//# sourceMappingURL=data:application/json;base64,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SUFBSSxDQUFDLEdBQUUsRUFBRTtRQUNuQixHQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRSxFQUFFO1FBQ3JCLEdBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFFLEVBQUU7UUFDckIsR0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLEdBQUUsR0FBRzs7S0FDckIsQ0FBQztJQUNGLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7O0FBQ3JCLENBQUM7QUFFRCxxQkFBcUIsSUFBWSxFQUFFLElBQVUsRUFBRSxJQUFjO0lBQ3pELE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDWCxLQUFLLFFBQVEsQ0FBQyxJQUFJO1lBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUFDLEtBQUssQ0FBQztRQUMvQyxLQUFLLFFBQVEsQ0FBQyxNQUFNO1lBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUFDLEtBQUssQ0FBQztRQUNuRCxLQUFLLFFBQVEsQ0FBQyxNQUFNO1lBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUFDLEtBQUssQ0FBQztRQUNuRCxLQUFLLFFBQVEsQ0FBQyxFQUFFO1lBQUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUFDLEtBQUssQ0FBQztRQUNwRCxTQUFTLE1BQU0sS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFDN0MsQ0FBQztBQUNMLENBQUM7QUFFWSx5QkFBaUIsR0FBRyxLQUFLLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDIiwiZmlsZSI6InRpbWVQaWNrZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMTUgUGFsYW50aXIgVGVjaG5vbG9naWVzLCBJbmMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQlNELTMgTGljZW5zZSBhcyBtb2RpZmllZCAodGhlIOKAnExpY2Vuc2XigJ0pOyB5b3UgbWF5IG9idGFpbiBhIGNvcHlcbiAqIG9mIHRoZSBsaWNlbnNlIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9wYWxhbnRpci9ibHVlcHJpbnQvYmxvYi9tYXN0ZXIvTElDRU5TRVxuICogYW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9wYWxhbnRpci9ibHVlcHJpbnQvYmxvYi9tYXN0ZXIvUEFURU5UU1xuICovXG5cbmltcG9ydCB7IElQcm9wcywgS2V5cywgVXRpbHMgYXMgQmx1ZXByaW50VXRpbHMgfSBmcm9tIFwiQGJsdWVwcmludGpzL2NvcmVcIjtcbmltcG9ydCAqIGFzIGNsYXNzTmFtZXMgZnJvbSBcImNsYXNzbmFtZXNcIjtcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gXCJyZWFjdFwiO1xuXG5pbXBvcnQgKiBhcyBDbGFzc2VzIGZyb20gXCIuL2NvbW1vbi9jbGFzc2VzXCI7XG5pbXBvcnQgKiBhcyBEYXRlVXRpbHMgZnJvbSBcIi4vY29tbW9uL2RhdGVVdGlsc1wiO1xuaW1wb3J0ICogYXMgVXRpbHMgZnJvbSBcIi4vY29tbW9uL3V0aWxzXCI7XG5cbmV4cG9ydCBlbnVtIFRpbWVQaWNrZXJQcmVjaXNpb24ge1xuICAgIE1JTlVURSxcbiAgICBTRUNPTkQsXG4gICAgTUlMTElTRUNPTkQsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVRpbWVQaWNrZXJQcm9wcyBleHRlbmRzIElQcm9wcyB7XG4gICAvKipcbiAgICAqIEluaXRpYWwgdGltZSB0aGUgYFRpbWVQaWNrZXJgIHdpbGwgZGlzcGxheS5cbiAgICAqIFRoaXMgc2hvdWxkIG5vdCBiZSBzZXQgaWYgYHZhbHVlYCBpcyBzZXQuXG4gICAgKi9cbiAgICBkZWZhdWx0VmFsdWU/OiBEYXRlO1xuXG4gICAvKipcbiAgICAqIENhbGxiYWNrIGludm9rZWQgd2hlbiB0aGUgdXNlciBjaGFuZ2VzIHRoZSB0aW1lLlxuICAgICovXG4gICAgb25DaGFuZ2U/OiAobmV3VGltZTogRGF0ZSkgPT4gdm9pZDtcblxuICAgLyoqXG4gICAgKiBUaGUgcHJlY2lzaW9uIG9mIHRpbWUgdGhlIHVzZXIgY2FuIHNldC5cbiAgICAqIEBkZWZhdWx0IFRpbWVQaWNrZXJQcmVjaXNpb24uTUlOVVRFXG4gICAgKi9cbiAgICBwcmVjaXNpb24/OiBUaW1lUGlja2VyUHJlY2lzaW9uO1xuXG4gICAvKipcbiAgICAqIFdoZXRoZXIgdG8gc2hvdyBhcnJvd3MgYnV0dG9ucyBmb3IgY2hhbmdpbmcgdGhlIHRpbWUuXG4gICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgICovXG4gICAgc2hvd0Fycm93QnV0dG9ucz86IEJvb2xlYW47XG5cbiAgIC8qKlxuICAgICogVGhlIGN1cnJlbnRseSBzZXQgdGltZS5cbiAgICAqIElmIHRoaXMgcHJvcCBpcyBwcmVzZW50LCB0aGUgY29tcG9uZW50IGFjdHMgaW4gYSBjb250cm9sbGVkIG1hbm5lci5cbiAgICAqL1xuICAgIHZhbHVlPzogRGF0ZTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJVGltZVBpY2tlclN0YXRlIHtcbiAgICBob3VyVGV4dD86IHN0cmluZztcbiAgICBtaW51dGVUZXh0Pzogc3RyaW5nO1xuICAgIHNlY29uZFRleHQ/OiBzdHJpbmc7XG4gICAgbWlsbGlzZWNvbmRUZXh0Pzogc3RyaW5nO1xuICAgIHZhbHVlPzogRGF0ZTtcbn1cblxuZXhwb3J0IGNsYXNzIFRpbWVQaWNrZXIgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVRpbWVQaWNrZXJQcm9wcywgSVRpbWVQaWNrZXJTdGF0ZT4ge1xuICAgIHB1YmxpYyBzdGF0aWMgZGVmYXVsdFByb3BzOiBJVGltZVBpY2tlclByb3BzID0ge1xuICAgICAgICBwcmVjaXNpb246IFRpbWVQaWNrZXJQcmVjaXNpb24uTUlOVVRFLFxuICAgICAgICBzaG93QXJyb3dCdXR0b25zOiBmYWxzZSxcbiAgICB9O1xuXG4gICAgcHVibGljIGRpc3BsYXlOYW1lID0gXCJCbHVlcHJpbnQuVGltZVBpY2tlclwiO1xuXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKHByb3BzPzogSVRpbWVQaWNrZXJQcm9wcywgY29udGV4dD86IGFueSkge1xuICAgICAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XG5cbiAgICAgICAgaWYgKHByb3BzLnZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSB0aGlzLmdldEZ1bGxTdGF0ZUZyb21WYWx1ZShwcm9wcy52YWx1ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAocHJvcHMuZGVmYXVsdFZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSB0aGlzLmdldEZ1bGxTdGF0ZUZyb21WYWx1ZShwcm9wcy5kZWZhdWx0VmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IHRoaXMuZ2V0RnVsbFN0YXRlRnJvbVZhbHVlKG5ldyBEYXRlKDAsIDAsIDAsIDAsIDAsIDAsIDApKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHNob3VsZFJlbmRlclNlY29uZHMgPSB0aGlzLnByb3BzLnByZWNpc2lvbiA+PSBUaW1lUGlja2VyUHJlY2lzaW9uLlNFQ09ORDtcbiAgICAgICAgY29uc3Qgc2hvdWxkUmVuZGVyTWlsbGlzZWNvbmRzID0gdGhpcy5wcm9wcy5wcmVjaXNpb24gPj0gVGltZVBpY2tlclByZWNpc2lvbi5NSUxMSVNFQ09ORDtcblxuICAgICAgICAvKiB0c2xpbnQ6ZGlzYWJsZTptYXgtbGluZS1sZW5ndGggKi9cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtjbGFzc05hbWVzKENsYXNzZXMuVElNRVBJQ0tFUiwgdGhpcy5wcm9wcy5jbGFzc05hbWUpfT5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17Q2xhc3Nlcy5USU1FUElDS0VSX0FSUk9XX1JPV30+XG4gICAgICAgICAgICAgICAgICAgIHt0aGlzLm1heWJlUmVuZGVyQXJyb3dCdXR0b24odHJ1ZSwgQ2xhc3Nlcy5USU1FUElDS0VSX0hPVVIsICgpID0+IHRoaXMuaW5jcmVtZW50VGltZShUaW1lVW5pdC5IT1VSKSl9XG4gICAgICAgICAgICAgICAgICAgIHt0aGlzLm1heWJlUmVuZGVyQXJyb3dCdXR0b24odHJ1ZSwgQ2xhc3Nlcy5USU1FUElDS0VSX01JTlVURSwgKCkgPT4gdGhpcy5pbmNyZW1lbnRUaW1lKFRpbWVVbml0Lk1JTlVURSkpfVxuICAgICAgICAgICAgICAgICAgICB7c2hvdWxkUmVuZGVyU2Vjb25kcyA/IHRoaXMubWF5YmVSZW5kZXJBcnJvd0J1dHRvbih0cnVlLCBDbGFzc2VzLlRJTUVQSUNLRVJfU0VDT05ELCAoKSA9PiB0aGlzLmluY3JlbWVudFRpbWUoVGltZVVuaXQuU0VDT05EKSkgOiBudWxsfVxuICAgICAgICAgICAgICAgICAgICB7c2hvdWxkUmVuZGVyTWlsbGlzZWNvbmRzID8gdGhpcy5tYXliZVJlbmRlckFycm93QnV0dG9uKHRydWUsIENsYXNzZXMuVElNRVBJQ0tFUl9NSUxMSVNFQ09ORCwgKCkgPT4gdGhpcy5pbmNyZW1lbnRUaW1lKFRpbWVVbml0Lk1TKSkgOiBudWxsfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtDbGFzc2VzLlRJTUVQSUNLRVJfSU5QVVRfUk9XfT5cbiAgICAgICAgICAgICAgICAgICAge3RoaXMucmVuZGVySW5wdXQoQ2xhc3Nlcy5USU1FUElDS0VSX0hPVVIsIFRpbWVVbml0LkhPVVIsIHRoaXMuc3RhdGUuaG91clRleHQpfVxuICAgICAgICAgICAgICAgICAgICB7dGhpcy5yZW5kZXJEaXZpZGVyKCl9XG4gICAgICAgICAgICAgICAgICAgIHt0aGlzLnJlbmRlcklucHV0KENsYXNzZXMuVElNRVBJQ0tFUl9NSU5VVEUsIFRpbWVVbml0Lk1JTlVURSwgdGhpcy5zdGF0ZS5taW51dGVUZXh0KX1cbiAgICAgICAgICAgICAgICAgICAge3Nob3VsZFJlbmRlclNlY29uZHMgPyB0aGlzLnJlbmRlckRpdmlkZXIoKSA6IG51bGx9XG4gICAgICAgICAgICAgICAgICAgIHtzaG91bGRSZW5kZXJTZWNvbmRzID8gdGhpcy5yZW5kZXJJbnB1dChDbGFzc2VzLlRJTUVQSUNLRVJfU0VDT05ELCBUaW1lVW5pdC5TRUNPTkQsIHRoaXMuc3RhdGUuc2Vjb25kVGV4dCkgOiBudWxsfVxuICAgICAgICAgICAgICAgICAgICB7c2hvdWxkUmVuZGVyTWlsbGlzZWNvbmRzID8gdGhpcy5yZW5kZXJEaXZpZGVyKFwiLlwiKSA6IG51bGx9XG4gICAgICAgICAgICAgICAgICAgIHtzaG91bGRSZW5kZXJNaWxsaXNlY29uZHMgPyB0aGlzLnJlbmRlcklucHV0KENsYXNzZXMuVElNRVBJQ0tFUl9NSUxMSVNFQ09ORCwgVGltZVVuaXQuTVMsIHRoaXMuc3RhdGUubWlsbGlzZWNvbmRUZXh0KSA6IG51bGx9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e0NsYXNzZXMuVElNRVBJQ0tFUl9BUlJPV19ST1d9PlxuICAgICAgICAgICAgICAgICAgICB7dGhpcy5tYXliZVJlbmRlckFycm93QnV0dG9uKGZhbHNlLCBDbGFzc2VzLlRJTUVQSUNLRVJfSE9VUiwgKCkgPT4gdGhpcy5kZWNyZW1lbnRUaW1lKFRpbWVVbml0LkhPVVIpKX1cbiAgICAgICAgICAgICAgICAgICAge3RoaXMubWF5YmVSZW5kZXJBcnJvd0J1dHRvbihmYWxzZSwgQ2xhc3Nlcy5USU1FUElDS0VSX01JTlVURSwgKCkgPT4gdGhpcy5kZWNyZW1lbnRUaW1lKFRpbWVVbml0Lk1JTlVURSkpfVxuICAgICAgICAgICAgICAgICAgICB7c2hvdWxkUmVuZGVyU2Vjb25kcyA/IHRoaXMubWF5YmVSZW5kZXJBcnJvd0J1dHRvbihmYWxzZSwgQ2xhc3Nlcy5USU1FUElDS0VSX1NFQ09ORCwgKCkgPT4gdGhpcy5kZWNyZW1lbnRUaW1lKFRpbWVVbml0LlNFQ09ORCkpIDogbnVsbH1cbiAgICAgICAgICAgICAgICAgICAge3Nob3VsZFJlbmRlck1pbGxpc2Vjb25kcyA/IHRoaXMubWF5YmVSZW5kZXJBcnJvd0J1dHRvbihmYWxzZSwgQ2xhc3Nlcy5USU1FUElDS0VSX01JTExJU0VDT05ELCAoKSA9PiB0aGlzLmRlY3JlbWVudFRpbWUoVGltZVVuaXQuTVMpKSA6IG51bGx9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICAgICAgLyogdHNsaW50OmVuYWJsZTptYXgtbGluZS1sZW5ndGggKi9cbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHM6IElUaW1lUGlja2VyUHJvcHMpIHtcbiAgICAgICAgaWYgKG5leHRQcm9wcy52YWx1ZSAhPSBudWxsICYmICFEYXRlVXRpbHMuYXJlU2FtZVRpbWUobmV4dFByb3BzLnZhbHVlLCB0aGlzLnByb3BzLnZhbHVlKSkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh0aGlzLmdldEZ1bGxTdGF0ZUZyb21WYWx1ZShuZXh0UHJvcHMudmFsdWUpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGJlZ2luIG1ldGhvZCBkZWZpbml0aW9uczogcmVuZGVyaW5nXG5cbiAgICBwcml2YXRlIG1heWJlUmVuZGVyQXJyb3dCdXR0b24oXG4gICAgICAgIGlzRGlyZWN0aW9uVXA6IGJvb2xlYW4sXG4gICAgICAgIGNsYXNzTmFtZTogc3RyaW5nLFxuICAgICAgICBvbkNsaWNrOiBSZWFjdC5Nb3VzZUV2ZW50SGFuZGxlcjxIVE1MU3BhbkVsZW1lbnQ+LFxuICAgICkge1xuICAgICAgICBjb25zdCBjbGFzc2VzID0gY2xhc3NOYW1lcyhDbGFzc2VzLlRJTUVQSUNLRVJfQVJST1dfQlVUVE9OLCBjbGFzc05hbWUsIFwicHQtaWNvbi1zdGFuZGFyZFwiLCB7XG4gICAgICAgICAgICBcInB0LWljb24tY2hldnJvbi1kb3duXCI6ICFpc0RpcmVjdGlvblVwLFxuICAgICAgICAgICAgXCJwdC1pY29uLWNoZXZyb24tdXBcIjogaXNEaXJlY3Rpb25VcCxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3BzLnNob3dBcnJvd0J1dHRvbnMgPyA8c3BhbiBjbGFzc05hbWU9e2NsYXNzZXN9IG9uQ2xpY2s9e29uQ2xpY2t9Lz4gOiBudWxsO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVuZGVyRGl2aWRlcih0ZXh0ID0gXCI6XCIpIHtcbiAgICAgICAgcmV0dXJuIDxzcGFuIGNsYXNzTmFtZT17Q2xhc3Nlcy5USU1FUElDS0VSX0RJVklERVJfVEVYVH0+e3RleHR9PC9zcGFuPjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlcklucHV0KGNsYXNzTmFtZTogc3RyaW5nLCB1bml0OiBUaW1lVW5pdCwgdmFsdWU6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKENsYXNzZXMuVElNRVBJQ0tFUl9JTlBVVCwgY2xhc3NOYW1lKX1cbiAgICAgICAgICAgICAgICBvbkJsdXI9e3RoaXMuZ2V0SW5wdXRCbHVySGFuZGxlcih1bml0KX1cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5nZXRJbnB1dENoYW5nZUhhbmRsZXIodW5pdCl9XG4gICAgICAgICAgICAgICAgb25LZXlEb3duPXt0aGlzLmdldElucHV0S2V5RG93bkhhbmRsZXIodW5pdCl9XG4gICAgICAgICAgICAgICAgdmFsdWU9e3ZhbHVlfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBiZWdpbiBtZXRob2QgZGVmaW5pdGlvbnM6IGV2ZW50IGhhbmRsZXJzXG5cbiAgICBwcml2YXRlIGdldElucHV0Qmx1ckhhbmRsZXIgPSAodW5pdDogVGltZVVuaXQpID0+IChlOiBSZWFjdC5TeW50aGV0aWNFdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4ge1xuICAgICAgICBjb25zdCB0ZXh0ID0gZ2V0U3RyaW5nVmFsdWVGcm9tSW5wdXRFdmVudChlKTtcbiAgICAgICAgdGhpcy51cGRhdGVUaW1lKHBhcnNlSW50KHRleHQsIDEwKSwgdW5pdCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRJbnB1dENoYW5nZUhhbmRsZXIgPSAodW5pdDogVGltZVVuaXQpID0+IChlOiBSZWFjdC5TeW50aGV0aWNFdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4ge1xuICAgICAgICBjb25zdCBUV09fRElHSVRTID0gL15cXGR7MCwyfSQvO1xuICAgICAgICBjb25zdCBUSFJFRV9ESUdJVFMgPSAvXlxcZHswLDN9JC87XG4gICAgICAgIGNvbnN0IHRleHQgPSBnZXRTdHJpbmdWYWx1ZUZyb21JbnB1dEV2ZW50KGUpO1xuXG4gICAgICAgIGxldCBpc1ZhbGlkID0gZmFsc2U7XG4gICAgICAgIHN3aXRjaCAodW5pdCkge1xuICAgICAgICAgICAgY2FzZSBUaW1lVW5pdC5IT1VSOlxuICAgICAgICAgICAgY2FzZSBUaW1lVW5pdC5NSU5VVEU6XG4gICAgICAgICAgICBjYXNlIFRpbWVVbml0LlNFQ09ORDpcbiAgICAgICAgICAgICAgICBpc1ZhbGlkID0gVFdPX0RJR0lUUy50ZXN0KHRleHQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBUaW1lVW5pdC5NUzpcbiAgICAgICAgICAgICAgICBpc1ZhbGlkID0gVEhSRUVfRElHSVRTLnRlc3QodGV4dCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRocm93IEVycm9yKFwiSW52YWxpZCBUaW1lVW5pdFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpc1ZhbGlkKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHVuaXQpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFRpbWVVbml0LkhPVVI6IHRoaXMudXBkYXRlU3RhdGUoeyBob3VyVGV4dDogdGV4dCB9KTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBUaW1lVW5pdC5NSU5VVEU6IHRoaXMudXBkYXRlU3RhdGUoeyBtaW51dGVUZXh0OiB0ZXh0IH0pOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFRpbWVVbml0LlNFQ09ORDogdGhpcy51cGRhdGVTdGF0ZSh7IHNlY29uZFRleHQ6IHRleHQgfSk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVGltZVVuaXQuTVM6IHRoaXMudXBkYXRlU3RhdGUoeyBtaWxsaXNlY29uZFRleHQ6IHRleHQgfSk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRocm93IEVycm9yKFwiSW52YWxpZCBUaW1lVW5pdFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0SW5wdXRLZXlEb3duSGFuZGxlciA9ICh1bml0OiBUaW1lVW5pdCkgPT4gKGU6IFJlYWN0LktleWJvYXJkRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICAgICAgaGFuZGxlS2V5RXZlbnQoZSwge1xuICAgICAgICAgICAgW0tleXMuQVJST1dfVVBdOiAoKSA9PiB0aGlzLmluY3JlbWVudFRpbWUodW5pdCksXG4gICAgICAgICAgICBbS2V5cy5BUlJPV19ET1dOXTogKCkgPT4gdGhpcy5kZWNyZW1lbnRUaW1lKHVuaXQpLFxuICAgICAgICAgICAgW0tleXMuRU5URVJdOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgKGUuY3VycmVudFRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS5ibHVyKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBiZWdpbiBtZXRob2QgZGVmaW5pdGlvbnM6IHN0YXRlIG1vZGlmaWNhdGlvblxuXG4gICAvKipcbiAgICAqIEdlbmVyYXRlcyBhIGZ1bGwgSVRpbWVQaWNrZXJTdGF0ZSBvYmplY3Qgd2l0aCBhbGwgdGV4dCBmaWVsZHMgc2V0IHRvIGZvcm1hdHRlZCBzdHJpbmdzIGJhc2VkIG9uIHZhbHVlXG4gICAgKi9cbiAgICBwcml2YXRlIGdldEZ1bGxTdGF0ZUZyb21WYWx1ZSh2YWx1ZTogRGF0ZSk6IElUaW1lUGlja2VyU3RhdGUge1xuICAgICAgICAvKiB0c2xpbnQ6ZGlzYWJsZTpvYmplY3QtbGl0ZXJhbC1zb3J0LWtleXMgKi9cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGhvdXJUZXh0OiBmb3JtYXRUaW1lKHZhbHVlLmdldEhvdXJzKCksIFRpbWVVbml0LkhPVVIpLFxuICAgICAgICAgICAgbWludXRlVGV4dDogZm9ybWF0VGltZSh2YWx1ZS5nZXRNaW51dGVzKCksIFRpbWVVbml0Lk1JTlVURSksXG4gICAgICAgICAgICBzZWNvbmRUZXh0OiBmb3JtYXRUaW1lKHZhbHVlLmdldFNlY29uZHMoKSwgVGltZVVuaXQuU0VDT05EKSxcbiAgICAgICAgICAgIG1pbGxpc2Vjb25kVGV4dDogZm9ybWF0VGltZSh2YWx1ZS5nZXRNaWxsaXNlY29uZHMoKSwgVGltZVVuaXQuTVMpLFxuICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgIH07XG4gICAgICAgIC8qIHRzbGludDplbmFibGU6b2JqZWN0LWxpdGVyYWwtc29ydC1rZXlzICovXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpbmNyZW1lbnRUaW1lKHVuaXQ6IFRpbWVVbml0KSB7XG4gICAgICAgIGNvbnN0IG5ld1RpbWUgPSBnZXRUaW1lVW5pdCh0aGlzLnN0YXRlLnZhbHVlLCB1bml0KSArIDE7XG4gICAgICAgIHRoaXMudXBkYXRlVGltZShsb29wVGltZShuZXdUaW1lLCB1bml0KSwgdW5pdCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkZWNyZW1lbnRUaW1lKHVuaXQ6IFRpbWVVbml0KSB7XG4gICAgICAgIGNvbnN0IG5ld1RpbWUgPSBnZXRUaW1lVW5pdCh0aGlzLnN0YXRlLnZhbHVlLCB1bml0KSAtIDE7XG4gICAgICAgIHRoaXMudXBkYXRlVGltZShsb29wVGltZShuZXdUaW1lLCB1bml0KSwgdW5pdCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVUaW1lKHRpbWU6IG51bWJlciwgdW5pdDogVGltZVVuaXQpIHtcbiAgICAgICAgaWYgKGlzVGltZVZhbGlkKHRpbWUsIHVuaXQpKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IERhdGVVdGlscy5jbG9uZSh0aGlzLnN0YXRlLnZhbHVlKTtcbiAgICAgICAgICAgIHNldFRpbWVVbml0KHRpbWUsIG5ld1ZhbHVlLCB1bml0KTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyB2YWx1ZTogbmV3VmFsdWUgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyByZXNldCB0byBsYXN0IGtub3duIGdvb2Qgc3RhdGVcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUodGhpcy5nZXRGdWxsU3RhdGVGcm9tVmFsdWUodGhpcy5zdGF0ZS52YWx1ZSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVTdGF0ZShzdGF0ZTogSVRpbWVQaWNrZXJTdGF0ZSkge1xuICAgICAgICBsZXQgbmV3U3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgY29uc3QgaGFzTmV3VmFsdWUgPSBuZXdTdGF0ZS52YWx1ZSAhPSBudWxsXG4gICAgICAgICAgICAmJiAhRGF0ZVV0aWxzLmFyZVNhbWVUaW1lKG5ld1N0YXRlLnZhbHVlLCB0aGlzLnN0YXRlLnZhbHVlKTtcblxuICAgICAgICBpZiAodGhpcy5wcm9wcy52YWx1ZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBjb21wb25lbnQgaXMgdW5jb250cm9sbGVkXG4gICAgICAgICAgICBpZiAoaGFzTmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICBuZXdTdGF0ZSA9IHRoaXMuZ2V0RnVsbFN0YXRlRnJvbVZhbHVlKG5ld1N0YXRlLnZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUobmV3U3RhdGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gY29tcG9uZW50IGlzIGNvbnRyb2xsZWQsIGFuZCB0aGVyZSdzIGEgbmV3IHZhbHVlXG4gICAgICAgICAgICAvLyBzbyBzZXQgaW5wdXRzJyB0ZXh0IGJhc2VkIG9mZiBvZiBfb2xkXyB2YWx1ZSBhbmQgbGF0ZXIgZmlyZSBvbkNoYW5nZSB3aXRoIG5ldyB2YWx1ZVxuICAgICAgICAgICAgaWYgKGhhc05ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh0aGlzLmdldEZ1bGxTdGF0ZUZyb21WYWx1ZSh0aGlzLnN0YXRlLnZhbHVlKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIG5vIG5ldyB2YWx1ZSwgdGhpcyBtZWFucyBvbmx5IHRleHQgaGFzIGNoYW5nZWQgKGZyb20gdXNlciB0eXBpbmcpXG4gICAgICAgICAgICAgICAgLy8gd2Ugd2FudCBpbnB1dHMgdG8gY2hhbmdlLCBzbyB1cGRhdGUgc3RhdGUgd2l0aCBuZXcgdGV4dCBmb3IgdGhlIGlucHV0c1xuICAgICAgICAgICAgICAgIC8vIGJ1dCBkb24ndCBjaGFuZ2UgYWN0dWFsIHZhbHVlXG4gICAgICAgICAgICAgICAgY29uc3QgY2xvbmVkTmV3U3RhdGUgPSBCbHVlcHJpbnRVdGlscy5zaGFsbG93Q2xvbmUobmV3U3RhdGUpO1xuICAgICAgICAgICAgICAgIGNsb25lZE5ld1N0YXRlLnZhbHVlID0gRGF0ZVV0aWxzLmNsb25lKHRoaXMuc3RhdGUudmFsdWUpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoY2xvbmVkTmV3U3RhdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGhhc05ld1ZhbHVlKSB7XG4gICAgICAgICAgICBCbHVlcHJpbnRVdGlscy5zYWZlSW52b2tlKHRoaXMucHJvcHMub25DaGFuZ2UsIG5ld1N0YXRlLnZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZW51bSBUaW1lVW5pdCB7XG4gICAgSE9VUixcbiAgICBNSU5VVEUsXG4gICAgU0VDT05ELFxuICAgIE1TLFxufVxuXG5mdW5jdGlvbiBmb3JtYXRUaW1lKHRpbWU6IG51bWJlciwgdW5pdDogVGltZVVuaXQpIHtcbiAgICBzd2l0Y2ggKHVuaXQpIHtcbiAgICAgICAgY2FzZSBUaW1lVW5pdC5IT1VSOlxuICAgICAgICAgICAgcmV0dXJuIHRpbWUudG9TdHJpbmcoKTtcbiAgICAgICAgY2FzZSBUaW1lVW5pdC5NSU5VVEU6XG4gICAgICAgIGNhc2UgVGltZVVuaXQuU0VDT05EOlxuICAgICAgICAgICAgcmV0dXJuIFV0aWxzLnBhZFdpdGhaZXJvZXModGltZS50b1N0cmluZygpLCAyKTtcbiAgICAgICAgY2FzZSBUaW1lVW5pdC5NUzpcbiAgICAgICAgICAgIHJldHVybiBVdGlscy5wYWRXaXRoWmVyb2VzKHRpbWUudG9TdHJpbmcoKSwgMyk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcIkludmFsaWQgVGltZVVuaXRcIik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBnZXRTdHJpbmdWYWx1ZUZyb21JbnB1dEV2ZW50KGU6IFJlYWN0LlN5bnRoZXRpY0V2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KSB7XG4gICAgcmV0dXJuIChlLmN1cnJlbnRUYXJnZXQgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWU7XG59XG5cbmZ1bmN0aW9uIGdldFRpbWVVbml0KGRhdGU6IERhdGUsIHVuaXQ6IFRpbWVVbml0KSB7XG4gICAgc3dpdGNoICh1bml0KSB7XG4gICAgICAgIGNhc2UgVGltZVVuaXQuSE9VUjogcmV0dXJuIGRhdGUuZ2V0SG91cnMoKTtcbiAgICAgICAgY2FzZSBUaW1lVW5pdC5NSU5VVEU6IHJldHVybiBkYXRlLmdldE1pbnV0ZXMoKTtcbiAgICAgICAgY2FzZSBUaW1lVW5pdC5TRUNPTkQ6IHJldHVybiBkYXRlLmdldFNlY29uZHMoKTtcbiAgICAgICAgY2FzZSBUaW1lVW5pdC5NUzogcmV0dXJuIGRhdGUuZ2V0TWlsbGlzZWNvbmRzKCk7XG4gICAgICAgIGRlZmF1bHQ6IHRocm93IEVycm9yKFwiSW52YWxpZCBUaW1lVW5pdFwiKTtcbiAgICB9XG59XG5cbmludGVyZmFjZSBJS2V5RXZlbnRNYXAgeyBba2V5OiBudW1iZXJdOiAoKSA9PiB2b2lkOyB9XG5cbmZ1bmN0aW9uIGhhbmRsZUtleUV2ZW50KGU6IFJlYWN0LktleWJvYXJkRXZlbnQ8SFRNTElucHV0RWxlbWVudD4sIGFjdGlvbnM6IElLZXlFdmVudE1hcCwgcHJldmVudERlZmF1bHQgPSB0cnVlKSB7XG4gICAgZm9yIChsZXQgayBvZiBPYmplY3Qua2V5cyhhY3Rpb25zKSkge1xuICAgICAgICBjb25zdCBrZXkgPSBOdW1iZXIoayk7XG4gICAgICAgIGlmIChlLndoaWNoID09PSBrZXkpIHtcbiAgICAgICAgICAgIGlmIChwcmV2ZW50RGVmYXVsdCkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFjdGlvbnNba2V5XSgpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBpc1RpbWVWYWxpZCh0aW1lOiBudW1iZXIsIHVuaXQ6IFRpbWVVbml0KSB7XG4gICAgcmV0dXJuIHRpbWUgIT0gbnVsbCAmJiAhaXNOYU4odGltZSkgJiYgbWluVGltZSh1bml0KSA8PSB0aW1lICYmIHRpbWUgPD0gbWF4VGltZSh1bml0KTtcbn1cblxuZnVuY3Rpb24gbG9vcFRpbWUodGltZTogbnVtYmVyLCB1bml0OiBUaW1lVW5pdCkge1xuICAgIGNvbnN0IG1heCA9IG1heFRpbWUodW5pdCk7XG4gICAgY29uc3QgbWluID0gbWluVGltZSh1bml0KTtcblxuICAgIGlmICh0aW1lID4gbWF4KSB7XG4gICAgICAgIHJldHVybiBtaW47XG4gICAgfSBlbHNlIGlmICh0aW1lIDwgbWluKSB7XG4gICAgICAgIHJldHVybiBtYXg7XG4gICAgfVxuICAgIHJldHVybiB0aW1lO1xufVxuXG5mdW5jdGlvbiBtaW5UaW1lKHVuaXQ6IFRpbWVVbml0KSB7XG4gICAgY29uc3QgbWluOiB7IFt1bml0OiBudW1iZXJdOiBudW1iZXIgfSA9IHtcbiAgICAgICAgW1RpbWVVbml0LkhPVVJdOiAwLFxuICAgICAgICBbVGltZVVuaXQuTUlOVVRFXTogMCxcbiAgICAgICAgW1RpbWVVbml0LlNFQ09ORF06IDAsXG4gICAgICAgIFtUaW1lVW5pdC5NU106IDAsXG4gICAgfTtcbiAgICByZXR1cm4gbWluW3VuaXRdO1xufVxuXG5mdW5jdGlvbiBtYXhUaW1lKHVuaXQ6IFRpbWVVbml0KSB7XG4gICAgY29uc3QgbWF4OiB7IFt1bml0OiBudW1iZXJdOiBudW1iZXIgfSA9IHtcbiAgICAgICAgW1RpbWVVbml0LkhPVVJdOiAyMyxcbiAgICAgICAgW1RpbWVVbml0Lk1JTlVURV06IDU5LFxuICAgICAgICBbVGltZVVuaXQuU0VDT05EXTogNTksXG4gICAgICAgIFtUaW1lVW5pdC5NU106IDk5OSxcbiAgICB9O1xuICAgIHJldHVybiBtYXhbdW5pdF07XG59XG5cbmZ1bmN0aW9uIHNldFRpbWVVbml0KHRpbWU6IG51bWJlciwgZGF0ZTogRGF0ZSwgdW5pdDogVGltZVVuaXQpIHtcbiAgICBzd2l0Y2ggKHVuaXQpIHtcbiAgICAgICAgY2FzZSBUaW1lVW5pdC5IT1VSOiBkYXRlLnNldEhvdXJzKHRpbWUpOyBicmVhaztcbiAgICAgICAgY2FzZSBUaW1lVW5pdC5NSU5VVEU6IGRhdGUuc2V0TWludXRlcyh0aW1lKTsgYnJlYWs7XG4gICAgICAgIGNhc2UgVGltZVVuaXQuU0VDT05EOiBkYXRlLnNldFNlY29uZHModGltZSk7IGJyZWFrO1xuICAgICAgICBjYXNlIFRpbWVVbml0Lk1TOiBkYXRlLnNldE1pbGxpc2Vjb25kcyh0aW1lKTsgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6IHRocm93IEVycm9yKFwiSW52YWxpZCBUaW1lVW5pdFwiKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBUaW1lUGlja2VyRmFjdG9yeSA9IFJlYWN0LmNyZWF0ZUZhY3RvcnkoVGltZVBpY2tlcik7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
